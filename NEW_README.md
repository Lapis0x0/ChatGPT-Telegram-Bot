# 已完成
- [x] 实现模型自决策的自动发送信息
- [x] 实现类OpenAI的前长期记忆系统



# 未来计划：
## 一、记忆系统优化
目前采用的记忆机制实际上效果还不错，但可能会添加重复冗余信息。可以根据在添加信息时已经标注好的主要等级进行拟人的，有记忆衰退曲线的自动遗忘机制。

针对部分时效性比较强的记忆，可以在过期后自动归档/删除。


## 二、进一步优化聊天系统

- [x] 为了让模型更好的知道当前的时间，应当在每一次对话的system prompt之前添加当前的日期（东八区）。

- [ ] 目前的主动触发机制仍然不完善；主动触发的时机是在每天凌晨1点就决定了的，没办法根据用户当前的对话内容来动态调整。可以添加一个“主动对话欲望”的数值机制，如果数值积累较高，则主动发起对话的几率也会随之增高。

5.3 2:05：提交：部分实现“主动对话欲望”的数值机制；但目前仍然不完善，对话衔接不够流畅，有“为话找话”的感觉；需要进一步优化，当前提交仅作checkpoint

5.2 2:17：
这样，我决定修改模型的“主动对话意愿”机制。

现在，主动对话意愿这个数值将不会再由flash模型去评价每一次对话来增删，而是更加符合**情侣之间**的聊天热度，这一数值会随着聊天空窗期时间的增加而不断增加，如果我在一定时间内没有找模型对话，按么模型就会根据之前的对话历史主动找我。

我希望最终的机制设计大致可以实现每天4-5次的主动对话。

1.主动对话意愿机制重构
移除原有通过flash模型分析每次对话内容来调整欲望值的机制。
新机制下，主动对话意愿值随用户与机器人的“空窗期”自动递增，用户每次主动对话后欲望值重置。
欲望值达到阈值后，机器人会主动发起对话，目标实现每日4-5次自然主动互动。
2.上下文与时间处理保持稳定
主动消息依然会带上历史对话上下文，确保连续性。
每次对话均在系统提示词中加入东八区当前时间，时间传递逻辑未变。
3.系统健壮性与可控性提升
欲望值增长率可通过环境变量灵活调整，便于后续微调主动消息频率。
保留了用户等待回复检测、连续对话等机制，避免重复打扰和对话割裂。
4.反思与改进方向
新机制更贴近真实情侣间的互动节奏，减少了“为话找话”的生硬感。
后续可结合内容分析作为微调补充，进一步提升对话的个性化和温度。
记忆系统、情绪系统等功能可作为后续优化重点，持续提升伴侣体验。

- [ ] 目前，大多数chatbot都采用一问一答的机制，诚然这样是最符合大多数chatbot对话需求的最优解的，但作为虚拟伴侣应尽量“拟人”，下一步可让模型自主判断当前对话是否需要一次性拆分/发送多条信息

- [ ] Gemini 2.5目前还是太喜欢输出各种拼音、英文了，应当在提示词这块进行优化，减少各种逆天英文解释的输出强度

## 三、语音系统
可尝试介入字节的豆包TTS系统，回复可选文字or语音TTS



## 四、情绪/心情机制（远期）

## 五、表情包系统（远期）

